#!/usr/bin/env python3
from llm_api import ask_openai                                  # Import API call function
from prompt_parser import parse_prompt_args                     # Import the parser for prompt instructions

import sys

def main() -> None:
    debugBool: bool = False
    testBool: bool = False                                      # Set True with "--test" flag
    args = sys.argv[1:]                                         # Cut out the gill command

    if debugBool:
        print(f"args are: ", args)

    if args[0] == "--test":
        testBool = True
        args = args[1:]

    try:
        prompt = parse_prompt_args(args)
    except ValueError as e:
        print(f"Argument error: {e}", file=sys.stderr)
        sys.exit(1)

    if prompt == "":
        print("Error: Provide at least one -m or -f option with content.", file=sys.stderr)
        sys.exit(1)

    if testBool or debugBool:
        print(prompt)
    else:
        try:
            response = ask_openai(prompt)                       # Call OpenAI API function
            print(response)
        except Exception as e:
            print(f"OpenAI API error: {e}", file=sys.stderr)
            sys.exit(1)

if __name__ == "__main__":
    main()